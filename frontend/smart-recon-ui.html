<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç SMART RECON - Professional Recon Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0d1117;
            color: #c9d1d9;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .header h1 {
            color: #58a6ff;
            margin-bottom: 10px;
        }
        .scan-panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .input-group {
            display: flex;
            gap: 10px;
        }
        .input-group input {
            flex: 1;
            background: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 12px;
            border-radius: 4px;
        }
        .input-group button {
            background: #238636;
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 4px;
            cursor: pointer;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
        }
        .stat-card.critical { border-color: #f85149; }
        .stat-value { font-size: 32px; color: #58a6ff; }
        .stat-card.critical .stat-value { color: #f85149; }
        .progress-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .progress-bar {
            height: 8px;
            background: #0d1117;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #238636, #2ea043);
            width: 0%;
            transition: width 0.3s;
        }
        .panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
        }
        .panel-header {
            background: #0d1117;
            padding: 15px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
        }
        .panel-content {
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }
        .url-item {
            padding: 10px;
            border-bottom: 1px solid #30363d;
            font-size: 12px;
            word-break: break-all;
            cursor: pointer;
        }
        .url-item:hover { background: #1f2937; }
        .url-item.sensitive { border-left: 3px solid #f85149; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 8px 16px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 4px;
            cursor: pointer;
        }
        .tab.active { background: #238636; border-color: #238636; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç SMART RECON - Professional Reconnaissance Tool</h1>
            <div style="color: #8b949e;">Finds sensitive files, secrets, and high-value URLs</div>
        </div>

        <div class="scan-panel">
            <div class="input-group">
                <input type="text" id="domainInput" placeholder="Enter domain (e.g., example.com)" value="example.com">
                <button id="scanBtn">START RECON</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="statUrls">0</div>
                <div class="stat-label">URLs Found</div>
            </div>
            <div class="stat-card critical">
                <div class="stat-value" id="statFiles">0</div>
                <div class="stat-label">Sensitive Files</div>
            </div>
            <div class="stat-card critical">
                <div class="stat-value" id="statSecrets">0</div>
                <div class="stat-label">Secrets</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statHighValue">0</div>
                <div class="stat-label">High-Value URLs</div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div style="margin-top: 10px; color: #8b949e;" id="progressDetail"></div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="highvalue">üî• High-Value</div>
            <div class="tab" data-tab="sensitive">üìÅ Sensitive Files</div>
            <div class="tab" data-tab="secrets">üîê Secrets</div>
            <div class="tab" data-tab="all">üìã All URLs</div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <span id="panelTitle">üî• High-Value URLs</span>
                <span id="panelCount">0</span>
            </div>
            <div class="panel-content" id="panelContent">
                <div style="text-align: center; padding: 40px; color: #8b949e;">
                    Enter a domain and start recon
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : '/api';

        const domainInput = document.getElementById('domainInput');
        const scanBtn = document.getElementById('scanBtn');
        const progressBar = document.getElementById('progressBar');
        const progressDetail = document.getElementById('progressDetail');
        const statUrls = document.getElementById('statUrls');
        const statFiles = document.getElementById('statFiles');
        const statSecrets = document.getElementById('statSecrets');
        const statHighValue = document.getElementById('statHighValue');
        const panelContent = document.getElementById('panelContent');
        const panelTitle = document.getElementById('panelTitle');
        const panelCount = document.getElementById('panelCount');

        let currentResults = null;

        // Tab switching
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                updatePanel(tab.dataset.tab);
            });
        });

        function updatePanel(tab) {
            if (!currentResults) return;

            panelTitle.textContent = {
                'highvalue': 'üî• High-Value URLs',
                'sensitive': 'üìÅ Sensitive Files',
                'secrets': 'üîê Secrets',
                'all': 'üìã All URLs'
            }[tab];

            let content = '';
            let count = 0;

            switch(tab) {
                case 'highvalue':
                    if (currentResults.data?.smartGrep?.highValueUrls) {
                        content = currentResults.data.smartGrep.highValueUrls.map(url => 
                            `<div class="url-item sensitive" onclick="window.open('${url}', '_blank')">${url}</div>`
                        ).join('');
                        count = currentResults.data.smartGrep.highValueUrls.length;
                    }
                    break;
                case 'sensitive':
                    if (currentResults.data?.smartGrep?.sensitiveFiles) {
                        content = currentResults.data.smartGrep.sensitiveFiles.map(file => 
                            `<div class="url-item" onclick="window.open('${file.url}', '_blank')">${file.url} <span style="color:#f85149;">[.${file.extension}]</span></div>`
                        ).join('');
                        count = currentResults.data.smartGrep.sensitiveFiles.length;
                    }
                    break;
                case 'secrets':
                    if (currentResults.data?.smartGrep?.secrets) {
                        content = currentResults.data.smartGrep.secrets.map(secret => 
                            `<div class="url-item sensitive" onclick="window.open('${secret.url}', '_blank')">
                                ${secret.url}<br>
                                <span style="color:#f85149; font-size:11px;">‚ö† ${secret.type}</span>
                            </div>`
                        ).join('');
                        count = currentResults.data.smartGrep.secrets.length;
                    }
                    break;
                case 'all':
                    if (currentResults.data?.urls) {
                        content = currentResults.data.urls.map(url => 
                            `<div class="url-item" onclick="window.open('${url}', '_blank')">${url}</div>`
                        ).join('');
                        count = currentResults.data.urls.length;
                    }
                    break;
            }

            panelContent.innerHTML = content || '<div style="text-align:center; padding:40px; color:#8b949e;">No results</div>';
            panelCount.textContent = count;
        }

        async function startScan() {
            const domain = domainInput.value.trim();
            if (!domain) return;

            scanBtn.disabled = true;
            scanBtn.textContent = 'SCANNING...';
            progressBar.style.width = '0%';
            
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 2;
                if (progress <= 90) {
                    progressBar.style.width = progress + '%';
                    progressDetail.textContent = `Scanning... ${progress}%`;
                }
            }, 500);

            try {
                const response = await fetch(`${API_BASE}/smart-recon`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domain })
                });

                clearInterval(progressInterval);

                if (!response.ok) throw new Error('Scan failed');

                const data = await response.json();
                currentResults = data;

                statUrls.textContent = data.summary?.urlsExtracted || 0;
                statFiles.textContent = data.summary?.sensitiveFiles || 0;
                statSecrets.textContent = data.summary?.secretsInUrls || 0;
                statHighValue.textContent = data.summary?.highValueUrls || 0;

                progressBar.style.width = '100%';
                progressDetail.textContent = `Scan complete in ${(data.duration / 1000).toFixed(2)}s`;

                const activeTab = document.querySelector('.tab.active').dataset.tab;
                updatePanel(activeTab);

            } catch (error) {
                clearInterval(progressInterval);
                progressBar.style.width = '0%';
                progressDetail.textContent = `Error: ${error.message}`;
            } finally {
                scanBtn.disabled = false;
                scanBtn.textContent = 'START RECON';
            }
        }

        scanBtn.addEventListener('click', startScan);
        domainInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') startScan();
        });
    </script>
</body>
</html>
